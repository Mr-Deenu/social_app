{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Social Media App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
     body{
        zoom: 1.18;          /* Chrome/Edge */
      }
    
      /* Firefox ke liye (optional) */
      @-moz-document url-prefix() {
        body { transform: scale(1.12); transform-origin: top center; }
      }
    body { background: #f5f5f5; }
    .navbar { background: #0d6efd; }
    .navbar-brand { color: white !important; font-weight: bold; }
    .dropdown-item { white-space: normal; }

    /* ‚úÖ Post cards center + max width */
    .post-card, .card { max-width: 100%; }
    @media (min-width: 768px) {
      .post-card, .card {
        max-width: 900px;
        margin-left: auto;
        margin-right: auto;
      }
    }

    /* ‚úÖ all navbar buttons same size */
    .nav-btn{
      height: 32px;
      padding: 0 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      line-height: 1;
    }
  </style>

  <script>
    function copyPostLink(link) {
      navigator.clipboard.writeText(link).then(() => alert("Post link copied ‚úÖ"));
    }
  </script>
</head>

<body>

<nav class="navbar navbar-expand-lg">
  <div class="container">

    <a class="navbar-brand" href="{% url 'home' %}">üöÄ SocialApp</a>
    
    <div class="d-flex gap-2 align-items-center">

      <a href="{% url 'home' %}" class="btn btn-light btn-sm nav-btn">Home</a>
      <a href="{% url 'reels' %}" class="btn btn-light btn-sm nav-btn">‚ñ∂</a>
       
      <!-- ‚úÖ Only ONE Search (navbar) -->
      <form class="d-flex" method="GET" action="{% url 'search' %}">
        <input name="q" class="form-control form-control-sm me-2" type="search" placeholder="Search users/posts">
        <button class="btn btn-light btn-sm nav-btn" type="submit">Search</button>
      </form>

      {% if user.is_authenticated %}

        <!-- ‚úÖ CHAT dropdown -->
        <div class="dropdown">
          <a class="btn btn-light btn-sm nav-btn dropdown-toggle position-relative"
             href="#"
             data-bs-toggle="dropdown"
             aria-expanded="false">
            üí¨
            {% if chat_unread_count > 0 %}
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                {{ chat_unread_count }}
              </span>
            {% endif %}
          </a>

          <ul class="dropdown-menu dropdown-menu-end p-2" style="width:320px;">
            <li class="px-2"><strong>Messages</strong></li>
            <hr class="my-1">

            {% for m in chat_unread_list %}
              <li class="px-3 py-2 border-bottom">
                <small class="text-muted d-block">{{ m.created|date:"M d, H:i" }}</small>
                <b>{{ m.sender.username }}</b>:
                {{ m.text|default:"(shared post)"|truncatechars:35 }}
              </li>
            {% empty %}
              <li class="dropdown-item text-muted small text-center">No unread messages</li>
            {% endfor %}

            <li class="text-center mt-2">
              <a href="{% url 'chat:chat_inbox' %}" class="small text-decoration-none">Open Inbox ‚Üí</a>
            </li>
          </ul>
        </div>

        <!-- ‚úÖ Notifications dropdown -->
        <div class="dropdown">
          <a class="btn btn-light btn-sm nav-btn dropdown-toggle position-relative"
             href="#"
             data-bs-toggle="dropdown"
             aria-expanded="false">
            üîî
            {% if notification_count > 0 %}
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                {{ notification_count }}
              </span>
            {% endif %}
          </a>

          <ul class="dropdown-menu dropdown-menu-end p-2" style="width:320px;">
            <li class="d-flex justify-content-between align-items-center px-2">
              <strong>Notifications</strong>
              <a href="{% url 'mark_notifications_read' %}" class="small text-decoration-none">Mark all read</a>
            </li>
            <hr class="my-1">

            {% for n in unread_notifications %}
              <li class="px-3 py-2 border-bottom">
                <small class="text-muted d-block">{{ n.created|date:"M d, H:i" }}</small>
                <a href="{% url 'open_notification' n.id %}" class="text-decoration-none text-dark">
                  {% if n.notification_type == "like" %}
                    ‚ù§Ô∏è <b>{{ n.sender.username }}</b> liked your post
                  {% elif n.notification_type == "comment" %}
                    üí¨ <b>{{ n.sender.username }}</b> commented on your post
                  {% elif n.notification_type == "follow" %}
                    üë§ <b>{{ n.sender.username }}</b> followed you
                  {% elif n.notification_type == "share" %}
                    üîÅ <b>{{ n.sender.username }}</b> shared your post
                  {% endif %}
                </a>
              </li>
            {% empty %}
              <li class="dropdown-item text-muted small text-center">No new notifications</li>
            {% endfor %}
          </ul>
        </div>

        
        <a href="{% url 'create_post' %}" class="btn btn-light btn-sm nav-btn">+Upload</a>
        
        <a href="{% url 'profile' user.username %}" class="btn btn-light btn-sm nav-btn">Profile</a>
        <!-- ‚úÖ OPTIONAL: agar create_reel banaya hai -->
        {# <a href="{% url 'create_reel' %}" class="btn btn-light btn-sm nav-btn">+ Reel</a> #}

        <form method="post" action="{% url 'logout' %}" class="d-inline">
          {% csrf_token %}
          <button type="submit" class="btn btn-light btn-sm nav-btn">Logout</button>
        </form>

      {% else %}

        <a href="{% url 'login' %}" class="btn btn-light btn-sm nav-btn">Login</a>
        <a href="{% url 'signup' %}" class="btn btn-light btn-sm nav-btn">Signup</a>

      {% endif %}

    </div>
  </div>
</nav>

<!-- ‚úÖ Back button navbar ke niche -->
{% if request.resolver_match and request.resolver_match.url_name != "home" %}
  <div class="container mt-2">
    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="window.history.back()">
      ‚Üê Back
    </button>
  </div>
{% endif %}

<div class="container mt-4">
  {% block content %}{% endblock %}
</div>

</body>
</html>
